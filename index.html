<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>전기차 충전소 정보</title>
</head>
<body>
	<div id="map" style="width:100%; height:100vh;"></div>
    <div style="padding:5px;"></div>

	<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=1848e7e473f0d3ce0ef13839f3ac3292"></script>
	<script>
		var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
		    mapOption = {
		        center: new kakao.maps.LatLng(37.56655, 126.98040), // 지도의 중심좌표
		        level: 5, // 지도의 확대 레벨
		        mapTypeId : kakao.maps.MapTypeId.ROADMAP // 지도종류
		    }; 

		// 지도를 생성한다 
		var map = new kakao.maps.Map(mapContainer, mapOption); 

        // 지도에 확대 축소 컨트롤을 생성한다
		var zoomControl = new kakao.maps.ZoomControl();

        // 지도의 우측에 확대 축소 컨트롤을 추가한다
        map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

	</script>
    
	<p id="data"></p>
	<script>
		const url = 'http://apis.data.go.kr/B552584/EvCharger/getChargerInfo?serviceKey=01WLGxbKXnjN3rE8LYR2E4q%2Bcg8DLmMXttqdG18q9%2BPYi2vLh1MxlMmqeCT45SxAd7dInYCEBlfXjq7CAu5kWw%3D%3D&numOfRows=100&pageNo=1&dataType=JSON';

		fetch(url)
		.then(res => res.json())
		.then(myJson => {
			// document.getElementById('data').innerText = JSON.stringify(myJson, null, 1);
			console.log(JSON.stringify(myJson, null, 1));
			
			const items = myJson.items;
			console.log(items.item.length);
			for (var i = 0; i < items.item.length; i++) {
				// 지도에 마커를 생성하고 표시한다
				var marker = new kakao.maps.Marker({
					position: new kakao.maps.LatLng(items.item[i]['lat'], items.item[i]['lng']), // 마커의 좌표
					map: map // 마커를 표시할 지도 객체
				});

				let stat = ""
				switch (items.item[i]['stat']) {
					case '1' :
						stat = "통신이상"
						break;
					case '2' :
						stat = "충전대기"
						break;
					case '3' :
						stat = "충전중"
						break;
					case '4' :
						stat = "운영중지"
						break;
					case '5' :
						stat = "점검중"
						break;
					case '9' :
						stat = "상태 미확인"
						break;
				}

				// 마커 위에 표시할 인포윈도우를 생성한다
				var infowindow = new kakao.maps.InfoWindow({
					content : items.item[i]['statNm'] + "<br/>" + stat// 인포윈도우에 표시할 내용
				});
				// 인포윈도우를 지도에 표시한다
				infowindow.open(map, marker);
			}
 		})
	</script>
</body>
</html>